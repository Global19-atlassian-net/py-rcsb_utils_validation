# File: tox.ini
# Updated:  3-Jul-2019 jdw
# -----------------
#
[tox]
envlist =  py37-flake8, py37-pylint, py37-formatting, py{37,27}, py37-coverage
#
skip_missing_interpreters = True
skip_install = False
skipsdist = False

#
[testenv]
platform=
       macos: darwin
       linux: linux

basepython =
    py27: python2.7
    py37: python3.7

whitelist_externals = echo
recreate = True
deps = echo
commands =
  echo "Starting tests"
  {envpython} -V
  {envpython} -m unittest discover  -v --start-directory rcsb/utils/tests-validation/ --pattern "test*.py"
  echo "Completed tests"

#
[testenv:py37-flake8]
whitelist_externals = echo
basepython = py37: python3.7
skip_install = false
deps =
    echo
    flake8
    flake8-docstrings>=0.2.7
    flake8-import-order>=0.9
commands =
    echo "Starting flake8 check"
    flake8 --max-line-length=185 --ignore=D,I,E203,W503 --exclude=rcsb/mock-data/ rcsb/utils/ setup.py
    echo "Completed flake8 check"
#
[testenv:py37-pylint]
whitelist_externals = echo
basepython = py37: python3.7
skip_install = false
deps =
    echo
    pylint
commands =
    echo "Start linting"
    pylint --disable=R,C --reports=n --rcfile={toxinidir}/pylintrc  rcsb/utils/
    echo "Completed linting"
#
[testenv:py37-formatting]
whitelist_externals = echo
basepython = py37: python3.7
deps =
    echo
    black>=19.3b0
    #    isort>=4.3.20
commands =
    echo "Check formatting"
    black --version
    black --line-length 180 --check  rcsb/utils
    # isort -rc rcsb/utils --check-only
    echo "Completed formatting"
changedir = {toxinidir}

#
[testenv:py37-coverage]
whitelist_externals = echo
basepython = py37: python3.7
deps =
    coverage
    echo
commands =
    echo "Evaluating coverage"
    coverage erase
    coverage run --parallel-mode --omit="rcsb/utils/tests-*","rcsb/mock-data/*" --source rcsb/utils/ -m unittest discover  --start-directory rcsb/utils/tests-validation/ --pattern "test*.py"
    coverage combine
    coverage report --omit="rcsb/mock-data/*","rcsb/utils/tests-validation/*"   --show-missing --fail-under=50
    - coverage html
    echo "Done with coverage"
